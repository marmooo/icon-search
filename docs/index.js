function loadConfig(){localStorage.getItem("darkMode")==1&&(document.documentElement.setAttribute("data-bs-theme","dark"),document.documentElement.setAttribute("data-filter","false"))}function toggleDarkMode(){if(localStorage.getItem("darkMode")==1){const e=document.documentElement.getAttribute("data-filter");e=="true"?document.documentElement.setAttribute("data-filter","false"):(localStorage.setItem("darkMode",0),document.documentElement.setAttribute("data-bs-theme","light"))}else localStorage.setItem("darkMode",1),document.documentElement.setAttribute("data-bs-theme","dark"),document.documentElement.setAttribute("data-filter","true")}function initSuggest(e,t,n){autocomplete({input:e,fetch:function(e,n){const s=t.filter(t=>t.startsWith(e));n(s)},render:function(e){const t=document.createElement("div");return t.textContent=e,t},onSelect:function(t){e.value=t,n()},minLength:1})}function initLightTags(){const e=10*1024*1024;return fetch(`${iconDB}/light.json`).then(e=>e.json()).then(t=>{let n=2,s=1;t.forEach(([t,o])=>{let i=n+o;n<e?lightTags.set(t,[n,i,s]):(s+=1,i=2+o,lightTags.set(t,[2,i,s])),n=i+2})})}function initHeavyTags(){return fetch(`${iconDB}/heavy.json`).then(e=>e.json()).then(e=>{e.forEach(([e,t])=>{heavyTags.set(e,t)})})}function initCollections(){return fetch(`${iconDB}/collections.json`).then(e=>e.json()).then(e=>{e.forEach(e=>{collections.set(e.name,e),delete e.name}),setCollectionsPanel()})}function initSearchTags(){const e=document.getElementById("searchText");return fetch(`${iconDB}/tags.json`).then(e=>e.json()).then(t=>{searchTags=new Set(t),initSuggest(e,t,searchIcons)})}function getSelectedIconPos(e){const t=[...document.getElementById("result").firstElementChild.children];return t.indexOf(e)}function showIconDetails(e){const t=new Image(128,128);t.setAttribute("decoding","async"),t.src=e.src;const n=document.getElementById("selectedIcon");n.firstElementChild.replaceWith(t)}function showIconSetDetails(e,t){const n=collections.get(t);document.getElementById("iconTags").textContent=e,document.getElementById("name").textContent=t,document.getElementById("name").href=n.homepage,document.getElementById("license").textContent=n.license,document.getElementById("license").href=n.licenseUrl,document.getElementById("author").textContent=n.author}function initIconTemplate(e){const t=new Image(e,e);return t.className="btn p-0",t.setAttribute("alt",""),t.setAttribute("role","button"),t.setAttribute("decoding","async"),t.setAttribute("data-bs-toggle","offcanvas"),t.setAttribute("data-bs-target","#details"),t.setAttribute("aria-controls","details"),t}function getPreviewIcon(e){const t=iconTemplate.cloneNode(),[n,s,o]=e;return t.onclick=()=>{selectedIconPos=getSelectedIconPos(t),showIconSetDetails(s,o),showIconDetails(t)},t.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(n),t}function drawChunk(e){buffer+=e;const t=buffer.lastIndexOf("	]");if(t<0)return;const n=buffer.indexOf("	["),s=buffer.slice(n+1,t+2);buffer=buffer.slice(t+3);const o=JSON.parse(`[${s}]`);drawIcons(o)}function drawIcons(e){const t=searchResults.length;if(searchResults=[...searchResults,...e],pagingFrom<=t+e.length&&t<pagingTo){const e=pagingFrom<t?t:pagingFrom,n=pagingTo<=0?searchResults.slice(e):searchResults.slice(e,pagingTo);n.forEach((t,n)=>{const s=e+n;worker.postMessage(s)})}}function redrawIcons(e,t){document.getElementById("loading").classList.remove("d-none");const s=document.getElementById("result"),i=document.createElement("div");s.replaceChild(i,s.firstElementChild);const n=document.getElementById("searchText").value;if(searchResults.length<pagingTo)if(heavyTags.has(n)){const e=heavyTags.get(n)-1;pageNumForHeavyTags<e&&(pageNumForHeavyTags+=1,fetchIcons(n))}else buffer.trimEnd()!="]"&&fetchIcons(n);const o=document.getElementById("filterText").value;if(o!="")searchResults.map((e,t)=>{if(e[1].includes(o))return[e,t]}).filter(e=>e).slice(e,t).forEach(e=>{const[n,t]=e;worker.postMessage(t)});else{const n=searchResults.slice(e,t);n.forEach((t,n)=>{const s=e+n;worker.postMessage(s)})}document.getElementById("loading").classList.add("d-none")}function disablePagination(e,t){e.href=`?q=${t}&from=${pagingFrom}&to=${pagingTo}`,e.parentNode.classList.add("disabled"),e.setAttribute("tabindex",-1),e.setAttribute("aria-disabled",!0),e.onclick=e=>{e.preventDefault()}}function enablePagination(e,t,n){const[s,o]=n();e.href=`?q=${t}&from=${s}&to=${o}`,e.parentNode.classList.remove("disabled"),e.removeAttribute("tabindex"),e.removeAttribute("aria-disabled"),e.onclick=e=>{e.preventDefault(),[pagingFrom,pagingTo]=n(),redrawIcons(pagingFrom,pagingTo),setPagination(t)}}function getPrevIndex(){return pagingFrom-pagingSize<0?[0,pagingSize]:[pagingFrom-pagingSize,pagingTo-pagingSize]}function getNextIndex(){return searchResults.length<pagingTo?[0,pagingSize]:[pagingFrom+pagingSize,pagingTo+pagingSize]}function setPagination(e){const s=`?q=${e}&from=${pagingFrom}&to=${pagingTo}`;history.replaceState(null,null,s);const n=document.getElementById("prevIcons"),t=document.getElementById("nextIcons");pagingFrom-pagingSize<0?disablePagination(n,e):enablePagination(n,e,getPrevIndex),heavyTags.has(e)?pageNumForHeavyTags<pagesForHeavyTags.length-1?enablePagination(t,e,getNextIndex):searchResults.length<pagingTo?disablePagination(t,e):enablePagination(t,e,getNextIndex):searchResults.length<pagingTo?disablePagination(t,e):enablePagination(t,e,getNextIndex)}function initFilterTags(){filterTags=new Set,searchResults.forEach(e=>{const t=e[1].split(",");t.forEach(e=>{filterTags.add(e)})});const e=document.getElementById("filterText");initSuggest(e,[...filterTags],filterResults)}function iconReader(e,t,n){return e.read().then(({done:s,value:o})=>{if(s){if(t.close(),!heavyTags.has(n))return;buffer.trimEnd()=="]"&&searchResults.length<pagingTo&&(pageNumForHeavyTags+=1,fetchIcons(n));return}const i=new TextDecoder("utf-8").decode(o);drawChunk(i),t.enqueue(o),iconReader(e,t,n)}).finally(()=>{document.getElementById("loading").classList.add("d-none"),document.getElementById("pagination").classList.remove("d-none"),setPagination(n),initFilterTags()})}let buffer="";function fetchIcons(e){if(lightTags.has(e)){const[t,n,s]=lightTags.get(e);return fetch(`${rareIconDB}/json/@rare.${s}.json`,{headers:{"content-type":"multipart/byteranges",range:`bytes=${t}-${n}`}}).then(e=>e.text()).then(e=>drawChunk(e)).finally(()=>{document.getElementById("loading").classList.add("d-none"),document.getElementById("pagination").classList.remove("d-none"),setPagination(e),initFilterTags()})}if(heavyTags.has(e)){const t=pagesForHeavyTags[pageNumForHeavyTags];return fetch(`${iconDB}/json/${e}.${t}.json`).then(t=>{const n=t.body.getReader();new ReadableStream({start(t){iconReader(n,t,e)}})})}return fetch(`${iconDB}/json/${e}.json`).then(t=>{const n=t.body.getReader();new ReadableStream({start(t){iconReader(n,t,e)}})})}function clearSearchCache(e){if(heavyTags.has(e)){const t=heavyTags.get(e);pagesForHeavyTags=Array(t).fill().map((e,t)=>t+1),shuffle(pagesForHeavyTags)}document.getElementById("filterText").value="",pageNumForHeavyTags=0,pagingFrom=0,pagingTo=pagingSize,searchResults=[],buffer="",prevSearchText=e}function searchIcons(){const t=document.getElementById("searchText"),e=t.value;if(prevSearchText==e)return;if(clearSearchCache(e),t.blur(),t.focus(),document.getElementById("loading").classList.remove("d-none"),document.getElementById("pagination").classList.add("d-none"),!searchTags.has(e)){document.getElementById("noTags").classList.remove("invisible");return}document.getElementById("noTags").classList.add("invisible");const n=document.getElementById("result"),s=document.createElement("div");n.replaceChild(s,n.firstElementChild),fetchIcons(e)}function filterIcons(e){const t=document.getElementById("searchText").value;pagingFrom=0,pagingTo=pagingSize;const n=`?q=${t}&from=0&to=${pagingSize}`;history.replaceState(null,null,n),searchResults.map((t,n)=>{if(t[1].includes(e))return[t,n]}).filter(e=>e).slice(0,pagingSize).forEach(e=>{const[n,t]=e;worker.postMessage(t)})}function filterResults(){const t=document.getElementById("result"),n=document.createElement("div");t.replaceChild(n,t.firstElementChild);const e=document.getElementById("filterText");e.blur(),e.focus(),filterIcons(e.value)}function sleep(e){return new Promise(t=>setTimeout(t,e))}function getOriginalSVG(){const e=pagingFrom+selectedIconPos;return searchResults[e][0]}async function copyToClipboard(){const e=document.getElementById("clipboard"),t=getOriginalSVG();await navigator.clipboard.writeText(t),e.textContent="âœ… copied!",await sleep(2e3),e.textContent="Copy to clipboard"}function downloadSVG(){const t="icon.svg",n=getOriginalSVG(),e=document.createElement("a");e.href="data:text/plain;charset=utf-8,"+encodeURIComponent(n),e.download=t,e.style.display="none",document.body.appendChild(e),e.click(),document.body.removeChild(e)}function shuffle(e){for(let t=e.length;1<t;t--){const n=Math.floor(Math.random()*t);[e[n],e[t-1]]=[e[t-1],e[n]]}return e}function setCollectionsPanel(){const e=Array.from(collections);setRecentlyCollections(e),setCollectionsTable(e)}function setRecentlyCollections(e){let t=`<table class="table table-sm table-striped"><tbody>`;e.reverse().slice(0,3).forEach(([e,n])=>{t+=`
      <tr>
        <td><a href="${n.homepage}">${e}</a></td>
        <td><a class="ps-1" href="${n.licenseUrl}">${n.license}</a></td>
      </tr>
    `}),t+="</tbody></table>",document.getElementById("recentlyCollections").innerHTML=t}function setCollectionsTable(e){let t=`<table class="table table-sm table-striped"><tbody>`;e.sort().forEach(([e,n])=>{t+=`
      <tr>
        <td><a href="${n.homepage}">${e}</a></td>
        <td><a class="ps-1" href="${n.licenseUrl}">${n.license}</a></td>
      </tr>
    `}),t+="</tbody></table>",document.getElementById("collectionsTable").innerHTML=t}loadConfig();const rareIconDB="/rare-icon-db",iconDB="https://icon-db.pages.dev",worker=new Worker("worker.js");worker.addEventListener("message",e=>{const t=e.data,n=searchResults[t],s=getPreviewIcon(n);document.getElementById("result").firstElementChild.appendChild(s)});const searchParams=new Proxy(new URLSearchParams(location.search),{get:(e,t)=>e.get(t)}),collections=new Map,heavyTags=new Map,lightTags=new Map;let searchTags=new Set,filterTags=new Set,searchResults=[],pagesForHeavyTags=[],pageNumForHeavyTags=0,pagingFrom=0,pagingTo=300,pagingSize=300,previewSize=32,prevSearchText="",selectedIconPos;const iconTemplate=initIconTemplate(previewSize);searchParams.from&&(pagingFrom=parseInt(searchParams.from)),searchParams.to&&(pagingTo=parseInt(searchParams.to)),new bootstrap.Offcanvas(document.getElementById("details")),Promise.all([initSearchTags(),initCollections(),initHeavyTags(),initLightTags()]).then(()=>{const e=searchParams.q;e&&(document.getElementById("searchText").value=e,searchIcons())}),document.getElementById("toggleDarkMode").onclick=toggleDarkMode,document.getElementById("search").onclick=searchIcons,document.getElementById("filter").onclick=filterResults,document.getElementById("download").onclick=downloadSVG,document.getElementById("clipboard").onclick=copyToClipboard,document.getElementById("pagingSize").onchange=e=>{pagingSize=parseInt(e.target.value),pagingTo=pagingFrom+pagingSize;const t=document.getElementById("searchText").value;if(t){const e=`?q=${t}&from=${pagingFrom}&to=${pagingTo}`;history.replaceState(null,null,e),redrawIcons(pagingFrom,pagingTo),setPagination(t)}},document.getElementById("previewSize").onchange=e=>{previewSize=e.target.value.split("x")[0],iconTemplate.setAttribute("width",previewSize),iconTemplate.setAttribute("height",previewSize);const t=document.getElementById("result");[...t.firstElementChild.children].forEach(e=>{e.setAttribute("width",previewSize),e.setAttribute("height",previewSize)})}