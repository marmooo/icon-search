function loadConfig(){localStorage.getItem("darkMode")==1&&(document.documentElement.dataset.theme="dark")}function toggleDarkMode(){localStorage.getItem("darkMode")==1?(localStorage.setItem("darkMode",0),delete document.documentElement.dataset.theme):(localStorage.setItem("darkMode",1),document.documentElement.dataset.theme="dark")}function initSuggest(b,c){let a="";b.forEach(b=>{searchTags.add(b),a+=`<option>${b}</option>`}),c.insertAdjacentHTML("beforeend",a)}function initCollections(){return fetch("/icon-db/collections.json").then(a=>a.json()).then(a=>{a.forEach(a=>{collections.set(a.name,a),delete a.name})})}function initTags(){const a=document.getElementById("searchTags");return fetch("/icon-db/tags.json").then(a=>a.json()).then(b=>initSuggest(b,a))}function showIconDetails(c,b){const d=b[1],e=b[2];showIconSetDetails(d,e);const a=c.cloneNode(!0);a.removeAttribute("role"),a.removeAttribute("data-bs-toggle"),a.removeAttribute("data-bs-target"),a.removeAttribute("aria-controls"),a.setAttribute("width",128),a.setAttribute("height",128),a.onclick=null;const f=document.getElementById("selectedIcon");f.firstElementChild.replaceWith(a)}function showIconSetDetails(c,b){const a=collections.get(b);document.getElementById("iconTags").textContent=c,document.getElementById("name").textContent=b,document.getElementById("name").href=a.homepage,document.getElementById("license").textContent=a.license,document.getElementById("license").href=a.licenseUrl,document.getElementById("author").textContent=a.author}function getPreviewIcon(b,c,d){const e=d.parseFromString(b[0],"image/svg+xml"),a=e.documentElement;return a.setAttribute("width",c),a.setAttribute("height",c),a.setAttribute("role","button"),a.setAttribute("data-bs-toggle","offcanvas"),a.setAttribute("data-bs-target","#details"),a.setAttribute("aria-controls","details"),a.onclick=()=>{showIconDetails(a,b)},a}function draw(b,c,d,e){buffer+=b;const a=buffer.lastIndexOf("	]");if(a<0)return;const f=buffer.slice(renderStartPos,a+2);renderStartPos=0,buffer=buffer.slice(a+3);const g=JSON.parse(`[${f}]`);drawIcons(g,c,d,e)}function drawIcons(b,c,d,e){const a=searchResults.length;if(searchResults=[...searchResults,...b],renderFrom<=a+b.length&&a<renderTo){const b=renderFrom<a?a:renderFrom,f=renderTo<=0?searchResults.slice(b):searchResults.slice(b,renderTo);f.forEach(b=>{const a=getPreviewIcon(b,d,e);c.appendChild(a),uniqIds(a)})}}function redrawIcons(c,d){const e=document.getElementById("previewSize").value.split("x")[0],a=document.getElementById("result"),b=document.createElement("div");a.replaceChild(b,a.firstChild);const f=new DOMParser,g=searchResults.slice(c,d);g.forEach(c=>{const a=getPreviewIcon(c,e,f);b.appendChild(a),uniqIds(a)})}function disablePagination(a,b){renderFrom=0,renderTo=renderNum,a.href=`?q=${b}&from=${renderFrom}&to=${renderTo}`,a.parentNode.classList.add("disabled"),a.setAttribute("tabindex",-1),a.setAttribute("aria-disabled",!0),a.onclick=a=>{a.preventDefault()}}function getPrevIndex(){return renderFrom-renderNum<0?[0,renderNum]:[renderFrom-renderNum,renderTo-renderNum]}function getNextIndex(){return searchResults.length<renderTo?[0,renderFrom-renderNum]:[renderFrom+renderNum,renderTo+renderNum]}function setPagination(a){const d=`?q=${a}&from=${renderFrom}&to=${renderTo}`;history.replaceState(null,null,d);const b=document.getElementById("prevIcons"),c=document.getElementById("nextIcons"),[e,f]=getPrevIndex();renderFrom-renderNum<0?disablePagination(b,a):(b.href=`?q=${a}&from=${e}&to=${f}`,b.parentNode.classList.remove("disabled"),b.removeAttribute("tabindex"),b.removeAttribute("aria-disabled"),b.onclick=b=>{b.preventDefault(),[renderFrom,renderTo]=getPrevIndex(),redrawIcons(renderFrom,renderTo),setPagination(a)});const[g,h]=getNextIndex();searchResults.length<renderTo?disablePagination(c,a):(c.href=`?q=${a}&from=${g}&to=${h}`,c.parentNode.classList.remove("disabled"),c.removeAttribute("tabindex"),c.removeAttribute("aria-disabled"),c.onclick=b=>{b.preventDefault(),[renderFrom,renderTo]=getNextIndex(),redrawIcons(renderFrom,renderTo),setPagination(a)})}let renderStartPos=1,buffer="";function fetchIcons(a){const d=document.getElementById("previewSize").value.split("x")[0],b=document.getElementById("result"),c=document.createElement("div");b.replaceChild(c,b.firstChild);const e=new DOMParser;return fetch(`/icon-db/json/${a}.json`).then(b=>{const f=b.body.getReader(),g=new ReadableStream({start(b){function g(){f.read().then(({done:h,value:f})=>{if(h){b.close(),renderStartPos=1,buffer="",document.getElementById("pagination").classList.remove("d-none"),setPagination(a);return}const i=new TextDecoder("utf-8").decode(f);draw(i,c,d,e),b.enqueue(f),g()})}g()}});return new Response(g,{headers:{"Content-Type":"application/json"}})})}function uniqIds(a){a.querySelectorAll("[id]").forEach(c=>{const d=c.id,b=Math.random().toString(16).slice(2),e=new RegExp(`url\\(#${d}\\);?`,"g");c.id=b,[...a.getElementsByTagName("*")].forEach(a=>{[...a.attributes].forEach(f=>{const c=f.name,d=f.value;if(c=="xlink:href"&&d.startsWith("#"))a.setAttribute(c,`#${b}`);else{const f=d.replace(e,`url(#${b});`);d!=f&&a.setAttribute(c,f)}})})})}function searchIcons(){const a=document.getElementById("searchText");a.blur(),a.focus();const b=a.value;if(document.getElementById("pagination").classList.add("d-none"),!searchTags.has(b)){document.getElementById("noTags").classList.remove("invisible");return}document.getElementById("noTags").classList.add("invisible"),fetchIcons(b).then(()=>{filterTags=new Set,searchResults.forEach(a=>{const b=a[1].split(",");b.forEach(a=>{filterTags.add(a)})});const a=document.getElementById("filterTags");a.replaceChildren(),initSuggest(filterTags,a)})}function filterIcons(b,a){searchResults.forEach((d,c)=>{d[1].includes(b)?a[c].classList.remove("d-none"):a[c].classList.add("d-none")})}function filterResults(){const b=[...document.getElementById("result").firstChild.children],a=document.getElementById("filterText");a.blur(),a.focus(),filterIcons(a.value,b)}function sleep(a){return new Promise(b=>setTimeout(b,a))}async function copyToClipboard(){const a=document.getElementById("clipboard"),b=document.getElementById("selectedIcon").innerHTML.trim();await navigator.clipboard.writeText(b),a.textContent="âœ… copied!",await sleep(2e3),a.textContent="Copy to clipboard"}function downloadSVG(){const b="icon.svg",c=document.getElementById("selectedIcon").innerHTML.trim(),a=document.createElement("a");a.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(c)),a.setAttribute("download",b),a.style.display="none",document.body.appendChild(a),a.click(),document.body.removeChild(a)}loadConfig();const searchParams=new Proxy(new URLSearchParams(location.search),{get:(a,b)=>a.get(b)}),collections=new Map,searchTags=new Set;let filterTags=new Set,searchResults=[],renderFrom=0,renderTo=300,renderNum=300,prevSearchText="";searchParams.from&&(renderFrom=parseInt(searchParams.from)),searchParams.to&&(renderTo=parseInt(searchParams.to)),new bootstrap.Offcanvas(document.getElementById("details")),Promise.all([initTags(),initCollections()]).then(()=>{searchParams.q&&(document.getElementById("searchText").value=searchParams.q,searchIcons())}),document.getElementById("toggleDarkMode").onclick=toggleDarkMode,document.getElementById("search").onclick=searchIcons,document.getElementById("searchText").onkeydown=a=>{prevSearchText!=a.target.value&&(searchResults=[]),a.key=="Enter"&&searchIcons()},document.getElementById("filter").onclick=filterResults,document.getElementById("filterText").onkeydown=a=>{a.key=="Enter"&&filterResults()},document.getElementById("download").onclick=downloadSVG,document.getElementById("clipboard").onclick=copyToClipboard,document.getElementById("previewSize").onchange=b=>{const a=b.target.value.split("x")[0],c=document.getElementById("result");[...c.firstChild.children].forEach(b=>{b.setAttribute("width",a),b.setAttribute("height",a)})}